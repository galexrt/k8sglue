{{ pillar['headers']['salt']['file'] }}

reactor:
  # Minion has started (this is after the key has been accepted)
  - 'salt/minion/*/start':
    - /srv/reactor/minion/sync_all.sls
    # Trigger salt key check if the minion isn't already in the list of accepted minions
    - /srv/reactor/minion/highstate.sls
  # Minion key has been accepted
  - 'custom/salt/minion/key/accepted':
    # Run highstate on minion
    - /srv/reactor/minion/highstate.sls
    - /srv/reactor/kubernetes/token-generate.sls
  # A node that wants to join the Kubernetes node sends this signal
  - 'custom/kubernetes/want-to-join':
    # Generate a kubeadm token for a node that wants to join the cluster
    - /srv/reactor/kubernetes/token-generate.sls
  # A token has been generated
  - 'custom/kubernetes/token-generated':
    # Join the node using the generated token
    - /srv/reactor/kubernetes/join-node.sls
  # A Kubernetes node has joined the Kubernetes cluster
  - 'custom/kubernetes/joined':
    # "Last" signal when a node has joined the cluster
    - /srv/reactor/kubernetes/node-joined.sls
